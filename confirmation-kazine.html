<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmed | KAZINE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #d4a574;
            --secondary: #8b4513;
            --success: #28a745;
            --info: #17a2b8;
            --twitter: #1DA1F2;
            --white: #ffffff;
            --light: #f8f9fa;
            --gray: #6c757d;
            --dark: #343a40;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Header */
        header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .logo {
            color: var(--primary);
            font-size: 2.8rem;
            margin-bottom: 10px;
        }
        
        .tagline {
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        /* Main Content */
        .confirmation-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: var(--success);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin: 0 auto 25px;
            animation: bounce 1s ease;
        }
        
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .confirmation-title {
            text-align: center;
            color: var(--success);
            font-size: 2.2rem;
            margin-bottom: 15px;
        }
        
        .confirmation-subtitle {
            text-align: center;
            color: var(--gray);
            font-size: 1.1rem;
            margin-bottom: 30px;
        }
        
        /* Order Summary */
        .order-summary {
            background: var(--light);
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .summary-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--dark);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .order-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 576px) {
            .order-details {
                grid-template-columns: 1fr;
            }
        }
        
        .detail-group h4 {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .detail-group p {
            color: var(--dark);
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .twitter-handle {
            color: var(--twitter);
            font-weight: 600;
        }
        
        /* Order Items */
        .order-items {
            margin: 25px 0;
        }
        
        .order-items-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .order-item:last-child {
            margin-bottom: 0;
        }
        
        .item-info h5 {
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .item-meta {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .item-price {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        /* Price Breakdown */
        .price-breakdown {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .price-row:last-child {
            border-bottom: none;
        }
        
        .price-row.total {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--success);
            border-top: 2px solid #e9ecef;
            padding-top: 15px;
            margin-top: 10px;
        }
        
        /* Action Section */
        .action-section {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
            border-left: 5px solid var(--success);
        }
        
        .action-title {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        /* Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            flex: 1;
            min-width: 200px;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .btn-twitter {
            background: var(--twitter);
            color: white;
        }
        
        .btn-twitter:hover {
            background: #0d8bd9;
            transform: translateY(-2px);
        }
        
        .btn-print {
            background: var(--success);
            color: white;
        }
        
        .btn-print:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        /* Status Messages */
        .status-message {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .spreadsheet-info {
            background: #fff3cd;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        
        .spreadsheet-info h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #856404;
            margin-bottom: 10px;
        }
        
        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e9ecef;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Receipt Styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                max-width: 100%;
                box-shadow: none;
            }
            
            .btn, .action-section, footer {
                display: none !important;
            }
            
            .confirmation-card {
                box-shadow: none;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <i class="fas fa-tshirt"></i> KAZINE
            </div>
            <p class="tagline">Thank you for your purchase!</p>
        </header>
        
        <!-- Loading State -->
        <div class="loading" id="loadingState">
            <div class="spinner"></div>
            <h3>Processing your order...</h3>
            <p>Please wait while we confirm your payment and process your order.</p>
        </div>
        
        <!-- Success State -->
        <div id="successState" style="display: none;">
            <div class="confirmation-card">
                <div class="success-icon">
                    <i class="fas fa-check"></i>
                </div>
                
                <h1 class="confirmation-title">Payment Successful!</h1>
                <p class="confirmation-subtitle">Your order has been confirmed and is being processed.</p>
                
                <!-- Order Summary -->
                <div class="order-summary">
                    <div class="summary-title">
                        <i class="fas fa-receipt"></i>
                        <h2>Order Summary</h2>
                    </div>
                    
                    <div class="order-details">
                        <div class="detail-group">
                            <h4>Order Number</h4>
                            <p id="orderNumber">KAZ-000000</p>
                        </div>
                        
                        <div class="detail-group">
                            <h4>Order Date</h4>
                            <p id="orderDate">Loading...</p>
                        </div>
                        
                        <div class="detail-group">
                            <h4>Customer Name</h4>
                            <p id="customerName">Loading...</p>
                        </div>
                        
                        <div class="detail-group">
                            <h4>Email Address</h4>
                            <p id="customerEmail">Loading...</p>
                        </div>
                        
                        <div class="detail-group">
                            <h4>Twitter/X Username</h4>
                            <p id="customerTwitter" class="twitter-handle">@loading</p>
                        </div>
                        
                        <div class="detail-group">
                            <h4>Payment Method</h4>
                            <p id="paymentMethod">Loading...</p>
                        </div>
                    </div>
                    
                    <!-- Order Items -->
                    <div class="order-items">
                        <div class="order-items-title">
                            <i class="fas fa-shopping-bag"></i>
                            <h3>Items Purchased</h3>
                            <span style="margin-left: auto; background: var(--primary); color: white; padding: 3px 10px; border-radius: 20px; font-size: 0.9rem;" id="itemsCount">0 items</span>
                        </div>
                        
                        <div id="orderItemsList">
                            <!-- Items will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Price Breakdown -->
                    <div class="price-breakdown">
                        <div class="price-row">
                            <span>Subtotal</span>
                            <span id="subtotal">$0.00</span>
                        </div>
                        <div class="price-row">
                            <span>Shipping</span>
                            <span id="shipping">$5.99</span>
                        </div>
                        <div class="price-row">
                            <span>Tax</span>
                            <span id="tax">$0.00</span>
                        </div>
                        <div class="price-row total">
                            <span>Total Paid</span>
                            <span id="totalAmount">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- Action Section -->
                <div class="action-section">
                    <h3 class="action-title">What's Next?</h3>
                    <p>Your order details have been saved to our spreadsheet. You will receive a confirmation email shortly.</p>
                    <p style="margin-top: 10px;"><strong>Order Status:</strong> <span style="color: var(--success);">‚úì Processing</span></p>
                </div>
                
                <!-- Spreadsheet Info -->
                <div class="spreadsheet-info" id="spreadsheetInfo" style="display: none;">
                    <h4><i class="fas fa-table"></i> Spreadsheet Update</h4>
                    <p>Your order has been recorded in our Google Sheets database.</p>
                    <p><strong>Status:</strong> <span id="spreadsheetStatus">Sending data...</span></p>
                </div>
                
                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-print" id="printReceiptBtn">
                        <i class="fas fa-print"></i> Print Receipt
                    </button>
                    <button class="btn btn-twitter" id="tweetOrderBtn">
                        <i class="fab fa-twitter"></i> Share on Twitter
                    </button>
                    <a href="kazine.html" class="btn btn-primary">
                        <i class="fas fa-store"></i> Back to Store
                    </a>
                    <a href="payment-kazine.html" class="btn btn-secondary">
                        <i class="fas fa-shopping-cart"></i> New Order
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Error State -->
        <div id="errorState" style="display: none;">
            <div class="confirmation-card">
                <div class="success-icon" style="background: #dc3545;">
                    <i class="fas fa-exclamation"></i>
                </div>
                
                <h1 class="confirmation-title" style="color: #dc3545;">Order Processing Failed</h1>
                <p class="confirmation-subtitle" id="errorMessage">We couldn't process your order. Please try again.</p>
                
                <div class="action-buttons">
                    <a href="payment-kazine.html" class="btn btn-primary">
                        <i class="fas fa-arrow-left"></i> Back to Payment
                    </a>
                    <a href="kazine.html" class="btn btn-secondary">
                        <i class="fas fa-store"></i> Back to Store
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer>
            <p><strong>KAZINE Fashion Store</strong> | Order Confirmation System</p>
            <p>This is a confirmation page. No actual payment was processed.</p>
        </footer>
    </div>

    <script>
        // Webhook URL untuk Google Sheets
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwI_cRH4qR_6DPQ2bfYmnCpYXqCI0TWWyE0ptKmwmG6ITpBX4DOxHkVS-KsLGl2OJmc/exec';
        
        // Data order dari halaman pembayaran
        let orderData = null;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç Mencari data order dari payment page...');
            
            // Cari data dari localStorage
            const possibleKeys = [
                'kazineOrderData',
                'kazinePaymentData',
                'kazineCheckoutData',
                'kazine_last_order',
                'paymentFormData'
            ];
            
            // Tampilkan semua isi localStorage untuk debugging
            console.log('üìä Isi localStorage:');
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.includes('kazine') || key.includes('payment')) {
                    console.log(`${key}:`, localStorage.getItem(key));
                }
            }
            
            // Cari data order
            for (const key of possibleKeys) {
                const storedData = localStorage.getItem(key);
                if (storedData) {
                    try {
                        orderData = JSON.parse(storedData);
                        console.log(`‚úÖ Data ditemukan di ${key}:`, orderData);
                        break;
                    } catch (e) {
                        console.warn(`‚ö†Ô∏è Gagal parse ${key}:`, e);
                    }
                }
            }
            
            // Jika tidak ada data di localStorage, coba dari URL parameters
            if (!orderData) {
                const urlParams = new URLSearchParams(window.location.search);
                const orderDataParam = urlParams.get('orderData');
                if (orderDataParam) {
                    try {
                        orderData = JSON.parse(decodeURIComponent(orderDataParam));
                        console.log('‚úÖ Data ditemukan di URL parameters');
                    } catch (e) {
                        console.warn('‚ö†Ô∏è Gagal parse URL parameters:', e);
                    }
                }
            }
            
            // Jika masih tidak ada data, tampilkan error
            if (!orderData) {
                showError('No order data found. Please complete the payment process first.');
                return;
            }
            
            // Normalize data
            normalizeOrderData();
            
            // Tampilkan data order
            displayOrderData();
            
            // Kirim ke Google Sheets
            sendToGoogleSheets();
            
            // Setup event listeners
            setupEventListeners();
        });
        
        // Normalize data order
        function normalizeOrderData() {
            // Pastikan struktur data konsisten
            if (!orderData.customer) orderData.customer = {};
            if (!orderData.items) orderData.items = [];
            if (!orderData.payment) orderData.payment = {};
            
            // Map field names
            if (orderData['customer-name'] && !orderData.customer.name) {
                orderData.customer.name = orderData['customer-name'];
            }
            if (orderData['customer-email'] && !orderData.customer.email) {
                orderData.customer.email = orderData['customer-email'];
            }
            if (orderData['customer-twitter'] && !orderData.customer.twitter) {
                orderData.customer.twitter = orderData['customer-twitter'];
            }
            if (orderData['customerTwitter'] && !orderData.customer.twitter) {
                orderData.customer.twitter = orderData.customerTwitter;
            }
            
            // Default values
            if (!orderData.customer.name) orderData.customer.name = 'Customer';
            if (!orderData.customer.email) orderData.customer.email = 'customer@example.com';
            if (!orderData.customer.twitter) orderData.customer.twitter = 'Not provided';
            if (!orderData.payment.method) orderData.payment.method = 'Credit Card';
            if (!orderData.notes) orderData.notes = 'No notes';
            
            // Calculate totals if not present
            if (!orderData.subtotal || orderData.subtotal === 0) {
                orderData.subtotal = orderData.items.reduce((sum, item) => {
                    const price = parseFloat(item.price) || 0;
                    const quantity = parseInt(item.quantity) || 1;
                    return sum + (price * quantity);
                }, 0);
            }
            
            if (!orderData.total || orderData.total === 0) {
                const subtotal = parseFloat(orderData.subtotal) || 0;
                const shipping = parseFloat(orderData.shipping) || 5.99;
                const tax = parseFloat(orderData.tax) || (subtotal * 0.08); // 8% tax
                orderData.total = subtotal + shipping + tax;
                orderData.shipping = shipping;
                orderData.tax = tax;
            }
            
            // Generate order number jika belum ada
            if (!orderData.orderNumber) {
                const timestamp = Date.now().toString().slice(-6);
                const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                orderData.orderNumber = `KAZ-${timestamp}${randomNum}`;
            }
            
            console.log('‚úÖ Normalized order data:', orderData);
        }
        
        // Tampilkan data order
        function displayOrderData() {
            // Hide loading, show success
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('successState').style.display = 'block';
            
            // Set order details
            document.getElementById('orderNumber').textContent = orderData.orderNumber;
            
            const orderDate = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('orderDate').textContent = orderDate;
            
            document.getElementById('customerName').textContent = orderData.customer.name;
            document.getElementById('customerEmail').textContent = orderData.customer.email;
            
            // Format Twitter handle
            let twitterHandle = orderData.customer.twitter;
            if (twitterHandle !== 'Not provided') {
                if (!twitterHandle.startsWith('@')) {
                    twitterHandle = '@' + twitterHandle;
                }
            }
            document.getElementById('customerTwitter').textContent = twitterHandle;
            
            document.getElementById('paymentMethod').textContent = orderData.payment.method || 'Credit Card';
            
            // Display items
            const orderItemsList = document.getElementById('orderItemsList');
            let itemsHTML = '';
            let totalItems = 0;
            
            if (orderData.items && orderData.items.length > 0) {
                orderData.items.forEach(item => {
                    const quantity = parseInt(item.quantity) || 1;
                    const price = parseFloat(item.price) || 0;
                    totalItems += quantity;
                    
                    itemsHTML += `
                        <div class="order-item">
                            <div class="item-info">
                                <h5>${item.title || item.name || 'Fashion Item'}</h5>
                                <div class="item-meta">
                                    Qty: ${quantity} 
                                    ${item.color ? ` | Color: ${item.color}` : ''}
                                    ${item.size ? ` | Size: ${item.size}` : ''}
                                </div>
                            </div>
                            <div class="item-price">$${(price * quantity).toFixed(2)}</div>
                        </div>
                    `;
                });
            } else {
                itemsHTML = '<div class="order-item"><div class="item-info"><h5>No items found</h5></div><div class="item-price">$0.00</div></div>';
            }
            
            orderItemsList.innerHTML = itemsHTML;
            document.getElementById('itemsCount').textContent = `${totalItems} item${totalItems !== 1 ? 's' : ''}`;
            
            // Set prices
            document.getElementById('subtotal').textContent = `$${orderData.subtotal.toFixed(2)}`;
            document.getElementById('shipping').textContent = `$${orderData.shipping.toFixed(2)}`;
            document.getElementById('tax').textContent = `$${orderData.tax.toFixed(2)}`;
            document.getElementById('totalAmount').textContent = `$${orderData.total.toFixed(2)}`;
        }
        
        // Kirim data ke Google Sheets
        async function sendToGoogleSheets() {
            const spreadsheetInfo = document.getElementById('spreadsheetInfo');
            const statusElement = document.getElementById('spreadsheetStatus');
            
            spreadsheetInfo.style.display = 'block';
            statusElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending data...';
            
            try {
                // Prepare data for Google Sheets
                const sheetData = {
                    action: 'addOrder',
                    timestamp: new Date().toISOString(),
                    orderNumber: orderData.orderNumber,
                    customerName: orderData.customer.name,
                    customerEmail: orderData.customer.email,
                    customerTwitter: orderData.customer.twitter,
                    items: JSON.stringify(orderData.items),
                    itemCount: orderData.items.length,
                    notes: orderData.notes || 'No notes',
                    subtotal: orderData.subtotal,
                    shipping: orderData.shipping,
                    tax: orderData.tax,
                    totalAmount: orderData.total,
                    paymentMethod: orderData.payment.method || 'Credit Card',
                    status: 'PROCESSED'
                };
                
                console.log('üì§ Mengirim ke Google Sheets:', sheetData);
                
                // Send data
                const response = await fetch(AKfycbwI_cRH4qR_6DPQ2bfYmnCpYXqCI0TWWyE0ptKmwmG6ITpBX4DOxHkVS-KsLGl2OJmc, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(sheetData)
                });
                
                // Update status (kita tidak bisa membaca response karena no-cors)
                statusElement.innerHTML = '<i class="fas fa-check-circle"></i> Data saved successfully!';
                statusElement.style.color = '#28a745';
                
                // Clear localStorage data setelah berhasil dikirim
                localStorage.removeItem('kazineOrderData');
                localStorage.removeItem('kazinePaymentData');
                localStorage.removeItem('kazineCheckoutData');
                
                console.log('‚úÖ Data berhasil dikirim ke Google Sheets');
                
            } catch (error) {
                console.error('‚ùå Error sending to Google Sheets:', error);
                statusElement.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Error: ${error.message}`;
                statusElement.style.color = '#dc3545';
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Print receipt button
            document.getElementById('printReceiptBtn').addEventListener('click', function() {
                window.print();
            });
            
            // Tweet order button
            document.getElementById('tweetOrderBtn').addEventListener('click', function() {
                const tweetText = `Just made a purchase at @kazine_fashion! Order #${orderData.orderNumber} - Total: $${orderData.total.toFixed(2)}`;
                const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
                window.open(tweetUrl, '_blank');
            });
            
            // Clear order data from localStorage when leaving page
            window.addEventListener('beforeunload', function() {
                localStorage.removeItem('kazineOrderData');
                localStorage.removeItem('kazinePaymentData');
            });
        }
        
        // Show error state
        function showError(message) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorState').style.display = 'block';
            document.getElementById('errorMessage').textContent = message;
        }
        
        // Prevent form resubmission
        if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.href);
        }
    </script>
</body>
</html>
